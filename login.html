<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIXXJURIS - Gestão Simplificada de Casos Jurídicos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            GoogleAuthProvider,
            signInWithPopup,
            FacebookAuthProvider
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            getDoc, 
            setDoc, 
            updateDoc,
            collection,
            query,
            where,
            getDocs,
            addDoc,
            deleteDoc
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBPFI-8FJJ2ACpxZhYcjW3ol9CBJzT_hAA",
            authDomain: "bixxjuris.firebaseapp.com",
            projectId: "bixxjuris",
            storageBucket: "bixxjuris.firebasestorage.app",
            messagingSenderId: "560618621657",
            appId: "1:560618621657:web:80aa9231e2b379473dccc8",
            measurementId: "G-WKZS0ZCKHC"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Make Firebase available globally
        window.firebase = {
            auth: {
                getAuth: () => auth,
                signInWithEmailAndPassword,
                createUserWithEmailAndPassword,
                signOut,
                onAuthStateChanged,
                GoogleAuthProvider,
                signInWithPopup,
                FacebookAuthProvider
            },
            firestore: {
                getFirestore: () => db,
                doc,
                getDoc,
                setDoc,
                updateDoc,
                collection,
                query,
                where,
                getDocs,
                addDoc,
                deleteDoc
            }
        };
    </script>

    <style>
        /* Variáveis CSS para cores */
        :root {
            --primary: #1E3A8A;
            --secondary: #16A34A;
            --neutral: #6B7280;
            --accent: #F97316;
            --light: #F9FAFB;
            --dark: #1F2937;
            --danger: #EF4444;
            --warning: #F59E0B;
        }

        /* Reset e estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }

        /* Layout principal */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--primary);
            color: white;
            transition: all 0.3s ease;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .sidebar-menu {
            padding: 15px 0;
        }

        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-left: 4px solid var(--accent);
        }

        .menu-item i {
            margin-right: 10px;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .menu-text {
            transition: opacity 0.3s;
        }

        .sidebar.collapsed .menu-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }

        .toggle-sidebar {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* Conteúdo principal */
        .main-content {
            flex: 1;
            margin-left: 250px;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 70px;
        }

        /* Header */
        .header {
            background-color: white;
            padding: 15px 30px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Conteúdo das páginas */
        .page-content {
            padding: 30px;
        }

        .page-title {
            margin-bottom: 20px;
            color: var(--primary);
            font-size: 1.8rem;
        }

        /* Cards de dashboard */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        .stat-card i {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-card.primary i { color: var(--primary); }
        .stat-card.secondary i { color: var(--secondary); }
        .stat-card.accent i { color: var(--accent); }
        .stat-card.neutral i { color: var(--neutral); }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .stat-label {
            color: var(--neutral);
            font-size: 0.9rem;
        }

        /* Tabelas */
        .table-container {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: #f8fafc;
            color: var(--primary);
            font-weight: 600;
        }

        tr:hover {
            background-color: #f9fafb;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending { background-color: #FEF3C7; color: #92400E; }
        .status-in-progress { background-color: #DBEAFE; color: #1E40AF; }
        .status-resolved { background-color: #D1FAE5; color: #065F46; }
        .status-agreed { background-color: #E0E7FF; color: #3730A3; }

        /* Formulários */
        .form-container {
            background-color: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Botões */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #172554;
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #15803d;
        }

        .btn-accent {
            background-color: var(--accent);
            color: white;
        }

        .btn-accent:hover {
            background-color: #ea580c;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--neutral);
            color: var(--dark);
        }

        .btn-outline:hover {
            background-color: #f3f4f6;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.9rem;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            padding: 25px;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--neutral);
        }

        /* Login e Cadastro */
        .auth-container {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, #3B82F6 100%);
        }

        .auth-box {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            display: flex;
            overflow: hidden;
        }

        .auth-welcome {
            flex: 1;
            background: linear-gradient(135deg, var(--primary) 0%, #1E3A8A 100%);
            color: white;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .auth-welcome h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .auth-welcome p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .auth-form-container {
            flex: 1;
            padding: 40px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
        }

        .auth-tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--neutral);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .auth-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-logo h1 {
            color: var(--primary);
            font-size: 2rem;
        }

        .auth-logo p {
            color: var(--neutral);
            font-size: 0.9rem;
        }

        .social-login {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .social-btn {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .social-btn:hover {
            background-color: #f9fafb;
        }

        .divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }

        .divider::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background-color: #eee;
        }

        .divider span {
            background-color: white;
            padding: 0 15px;
            color: var(--neutral);
            font-size: 0.9rem;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }

            .sidebar .menu-text {
                opacity: 0;
                width: 0;
                overflow: hidden;
            }

            .main-content {
                margin-left: 70px;
            }

            .stats-cards {
                grid-template-columns: 1fr;
            }

            .header {
                padding: 15px;
            }

            .page-content {
                padding: 15px;
            }

            .auth-box {
                flex-direction: column;
                max-width: 400px;
            }

            .auth-welcome {
                padding: 30px;
            }
        }

        @media (max-width: 576px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-menu-btn {
                display: block;
            }

            .auth-form-container {
                padding: 20px;
            }
        }

        /* Utilitários */
        .text-center { text-align: center; }
        .mb-20 { margin-bottom: 20px; }
        .mt-20 { margin-top: 20px; }
        .d-none { display: none; }
        .d-flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .align-center { align-items: center; }
        .w-100 { width: 100%; }

        /* Animações */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
    </style>
</head>
<body>
    <!-- Tela de Login/Cadastro -->
    <div id="authPage" class="auth-container">
        <div class="auth-box">
            <div class="auth-welcome">
                <h1>BIXXJURIS</h1>
                <p>Gestão simplificada de casos jurídicos</p>
                <p style="margin-top: 20px;">Soluções completas para advogados e escritórios de advocacia</p>
            </div>

            <div class="auth-form-container">
                <div class="auth-tabs">
                    <button class="auth-tab active" data-tab="login">Entrar</button>
                    <button class="auth-tab" data-tab="register">Cadastrar</button>
                </div>

                <!-- Formulário de Login -->
                <form id="loginForm" class="auth-form active">
                    <div class="auth-logo">
                        <h1>BIXXJURIS</h1>
                        <p>Faça login na sua conta</p>
                    </div>

                    <div class="social-login">
                        <button type="button" class="social-btn" onclick="loginWithGoogle()">
                            <i class="fab fa-google"></i> Google
                        </button>
                        <button type="button" class="social-btn" onclick="loginWithFacebook()">
                            <i class="fab fa-facebook"></i> Facebook
                        </button>
                    </div>

                    <div class="divider">
                        <span>ou</span>
                    </div>

                    <div class="form-group">
                        <label for="email">E-mail</label>
                        <input type="email" id="email" required>
                    </div>

                    <div class="form-group">
                        <label for="password">Senha</label>
                        <input type="password" id="password" required>
                    </div>

                    <button type="submit" class="btn btn-primary w-100" id="loginBtn">
                        <span id="loginText">Entrar</span>
                        <div class="loading d-none" id="loginLoading"></div>
                    </button>
                </form>

                <!-- Formulário de Cadastro -->
                <form id="registerForm" class="auth-form">
                    <div class="auth-logo">
                        <h1>BIXXJURIS</h1>
                        <p>Crie sua conta</p>
                    </div>

                    <div class="form-group">
                        <label for="registerCpf">CPF</label>
                        <input type="text" id="registerCpf" required maxlength="14" placeholder="000.000.000-00">
                    </div>

                    <div class="form-group">
                        <label for="registerEmail">E-mail</label>
                        <input type="email" id="registerEmail" required>
                    </div>

                    <div class="form-group">
                        <label for="registerName">Nome Completo</label>
                        <input type="text" id="registerName" required>
                    </div>

                    <div class="form-group">
                        <label for="registerPhone">Telefone Celular</label>
                        <input type="tel" id="registerPhone" required placeholder="(11) 99999-9999">
                    </div>

                    <div class="form-group">
                        <label for="registerPassword">Senha</label>
                        <input type="password" id="registerPassword" required minlength="6">
                    </div>

                    <div class="form-group">
                        <label for="registerConfirmPassword">Confirmar Senha</label>
                        <input type="password" id="registerConfirmPassword" required>
                    </div>

                    <button type="submit" class="btn btn-primary w-100" id="registerBtn">
                        <span id="registerText">Criar Conta</span>
                        <div class="loading d-none" id="registerLoading"></div>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Aplicação Principal -->
    <div id="app" class="app-container d-none">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>BIXXJURIS</h1>
                <p>Gestão Jurídica</p>
            </div>

            <div class="sidebar-menu">
                <div class="menu-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="menu-text">Dashboard</span>
                </div>

                <div class="menu-item" data-page="cases">
                    <i class="fas fa-folder"></i>
                    <span class="menu-text">Meus Casos</span>
                </div>

                <div class="menu-item" data-page="addCase">
                    <i class="fas fa-plus-circle"></i>
                    <span class="menu-text">Novo Caso</span>
                </div>

                <div class="menu-item" data-page="clients">
                    <i class="fas fa-users"></i>
                    <span class="menu-text">Clientes</span>
                </div>

                <div class="menu-item" data-page="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span class="menu-text">Relatórios</span>
                </div>

                <div class="menu-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span class="menu-text">Configurações</span>
                </div>
            </div>

            <button class="toggle-sidebar" id="toggleSidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>

        <!-- Conteúdo Principal -->
        <div class="main-content" id="mainContent">
            <!-- Header -->
            <div class="header">
                <div>
                    <button class="btn btn-outline mobile-menu-btn d-none" id="mobileMenuBtn">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>

                <div class="user-info">
                    <span id="userName">Usuário</span>
                    <div class="user-avatar" id="userAvatar">U</div>
                    <button class="btn btn-outline btn-sm" onclick="logout()">Sair</button>
                </div>
            </div>

            <!-- Conteúdo das Páginas -->
            <div class="page-content">
                <!-- Página: Dashboard -->
                <div id="dashboardPage" class="page">
                    <h2 class="page-title">Dashboard</h2>

                    <div class="stats-cards">
                        <div class="stat-card primary">
                            <i class="fas fa-folder"></i>
                            <div class="stat-value" id="totalCases">0</div>
                            <div class="stat-label">Total de Casos</div>
                        </div>

                        <div class="stat-card secondary">
                            <i class="fas fa-check-circle"></i>
                            <div class="stat-value" id="resolvedCases">0</div>
                            <div class="stat-label">Casos Resolvidos</div>
                        </div>

                        <div class="stat-card accent">
                            <i class="fas fa-clock"></i>
                            <div class="stat-value" id="pendingCases">0</div>
                            <div class="stat-label">Casos Pendentes</div>
                        </div>

                        <div class="stat-card neutral">
                            <i class="fas fa-dollar-sign"></i>
                            <div class="stat-value" id="totalValue">R$ 0</div>
                            <div class="stat-label">Valor Total</div>
                        </div>
                    </div>

                    <h3>Casos Recentes</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Título</th>
                                    <th>Cliente</th>
                                    <th>Valor</th>
                                    <th>Status</th>
                                    <th>Data</th>
                                </tr>
                            </thead>
                            <tbody id="recentCasesTable">
                                <!-- Dados serão preenchidos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Página: Meus Casos -->
                <div id="casesPage" class="page d-none">
                    <div class="d-flex justify-between align-center mb-20">
                        <h2 class="page-title">Meus Casos</h2>
                        <button class="btn btn-primary" onclick="showPage('addCase')">
                            <i class="fas fa-plus"></i> Novo Caso
                        </button>
                    </div>

                    <div class="filters mb-20">
                        <div class="d-flex" style="gap: 10px;">
                            <input type="text" id="caseSearch" placeholder="Buscar caso..." style="flex: 1;">
                            <select id="statusFilter">
                                <option value="">Todos os status</option>
                                <option value="pending">Pendente</option>
                                <option value="in-progress">Em andamento</option>
                                <option value="resolved">Resolvido</option>
                                <option value="agreed">Acordado</option>
                            </select>
                            <button class="btn btn-outline" onclick="filterCases()">
                                <i class="fas fa-filter"></i> Filtrar
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Título</th>
                                    <th>Cliente</th>
                                    <th>Valor</th>
                                    <th>Status</th>
                                    <th>Data de Criação</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="casesTable">
                                <!-- Dados serão preenchidos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Página: Adicionar/Editar Caso -->
                <div id="addCasePage" class="page d-none">
                    <h2 class="page-title" id="caseFormTitle">Novo Caso</h2>

                    <div class="form-container">
                        <form id="caseForm">
                            <input type="hidden" id="caseId">

                            <div class="form-group">
                                <label for="caseTitle">Título do Caso</label>
                                <input type="text" id="caseTitle" required>
                            </div>

                            <div class="form-group">
                                <label for="caseDescription">Descrição</label>
                                <textarea id="caseDescription" required></textarea>
                            </div>

                            <div class="form-group">
                                <label for="caseClient">Cliente/Parte Envolvida</label>
                                <input type="text" id="caseClient" required>
                            </div>

                            <div class="form-group">
                                <label for="caseValue">Valor (R$)</label>
                                <input type="number" id="caseValue" step="0.01" min="0">
                            </div>

                            <div class="form-group">
                                <label for="caseStatus">Status</label>
                                <select id="caseStatus" required>
                                    <option value="pending">Pendente</option>
                                    <option value="in-progress">Em andamento</option>
                                    <option value="resolved">Resolvido</option>
                                    <option value="agreed">Acordado</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="caseDate">Data de Criação</label>
                                <input type="date" id="caseDate" required>
                            </div>

                            <div class="action-buttons">
                                <button type="submit" class="btn btn-primary" id="saveCaseBtn">
                                    <span id="saveCaseText">Salvar Caso</span>
                                    <div class="loading d-none" id="saveCaseLoading"></div>
                                </button>
                                <button type="button" class="btn btn-outline" onclick="showPage('cases')">Cancelar</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Página: Clientes -->
                <div id="clientsPage" class="page d-none">
                    <h2 class="page-title">Clientes</h2>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>E-mail</th>
                                    <th>Telefone</th>
                                    <th>Casos Ativos</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="clientsTable">
                                <!-- Dados serão preenchidos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Página: Relatórios -->
                <div id="reportsPage" class="page d-none">
                    <h2 class="page-title">Relatórios</h2>

                    <div class="stats-cards">
                        <div class="stat-card primary">
                            <i class="fas fa-chart-line"></i>
                            <div class="stat-value" id="reportTotalCases">0</div>
                            <div class="stat-label">Total de Casos</div>
                        </div>

                        <div class="stat-card secondary">
                            <i class="fas fa-check-circle"></i>
                            <div class="stat-value" id="reportResolvedCases">0</div>
                            <div class="stat-label">Resolvidos</div>
                        </div>

                        <div class="stat-card accent">
                            <i class="fas fa-clock"></i>
                            <div class="stat-value" id="reportPendingCases">0</div>
                            <div class="stat-label">Pendentes</div>
                        </div>

                        <div class="stat-card neutral">
                            <i class="fas fa-dollar-sign"></i>
                            <div class="stat-value" id="reportTotalValue">R$ 0</div>
                            <div class="stat-label">Valor Total</div>
                        </div>
                    </div>

                    <div class="form-container">
                        <h3>Gerar Relatório</h3>
                        <form id="reportForm">
                            <div class="form-group">
                                <label for="reportType">Tipo de Relatório</label>
                                <select id="reportType">
                                    <option value="cases">Casos por Status</option>
                                    <option value="financial">Financeiro</option>
                                    <option value="clients">Casos por Cliente</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="reportPeriod">Período</label>
                                <select id="reportPeriod">
                                    <option value="all">Todo o período</option>
                                    <option value="month">Este mês</option>
                                    <option value="quarter">Este trimestre</option>
                                    <option value="year">Este ano</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </div>

                            <div class="form-group d-none" id="customDateRange">
                                <div class="d-flex" style="gap: 10px;">
                                    <div style="flex: 1;">
                                        <label for="startDate">Data Inicial</label>
                                        <input type="date" id="startDate">
                                    </div>
                                    <div style="flex: 1;">
                                        <label for="endDate">Data Final</label>
                                        <input type="date" id="endDate">
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-download"></i> Gerar Relatório
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Página: Configurações -->
                <div id="settingsPage" class="page d-none">
                    <h2 class="page-title">Configurações</h2>

                    <div class="form-container">
                        <h3>Perfil do Usuário</h3>
                        <form id="profileForm">
                            <div class="form-group">
                                <label for="userNameInput">Nome Completo</label>
                                <input type="text" id="userNameInput" required>
                            </div>

                            <div class="form-group">
                                <label for="userEmail">E-mail</label>
                                <input type="email" id="userEmail" required>
                            </div>

                            <div class="form-group">
                                <label for="userPhone">Telefone</label>
                                <input type="tel" id="userPhone">
                            </div>

                            <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                        </form>

                        <hr style="margin: 30px 0;">

                        <h3>Alterar Senha</h3>
                        <form id="passwordForm">
                            <div class="form-group">
                                <label for="currentPassword">Senha Atual</label>
                                <input type="password" id="currentPassword">
                            </div>

                            <div class="form-group">
                                <label for="newPassword">Nova Senha</label>
                                <input type="password" id="newPassword">
                            </div>

                            <div class="form-group">
                                <label for="confirmPassword">Confirmar Nova Senha</label>
                                <input type="password" id="confirmPassword">
                            </div>

                            <button type="submit" class="btn btn-primary">Alterar Senha</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para visualizar/editar caso -->
    <div class="modal" id="caseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalCaseTitle">Detalhes do Caso</h3>
                <button class="close-modal" onclick="closeModal('caseModal')">&times;</button>
            </div>

            <div id="modalCaseContent">
                <!-- Conteúdo será preenchidos via JavaScript -->
            </div>

            <div class="action-buttons mt-20">
                <button class="btn btn-primary" onclick="editCase()">Editar</button>
                <button class="btn btn-outline" onclick="closeModal('caseModal')">Fechar</button>
            </div>
        </div>
    </div>

    <script>
        // Dados globais
        let currentUser = null;
        let userData = null;
        let cases = [];

        // Inicialização da aplicação
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar eventos
            setupEventListeners();

            // Configurar máscaras de entrada
            setupInputMasks();

            // Verificar estado de autenticação
            if (window.firebase) {
                const { onAuthStateChanged } = window.firebase.auth;
                onAuthStateChanged(window.firebase.auth.getAuth(), (user) => {
                    if (user) {
                        currentUser = user;
                        loadUserData();
                    } else {
                        showAuth();
                    }
                });
            }
        });

        // Configurar máscaras de entrada
        function setupInputMasks() {
            const cpfInput = document.getElementById('registerCpf');
            const phoneInput = document.getElementById('registerPhone');

            if (cpfInput) {
                cpfInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length <= 11) {
                        value = value.replace(/(\d{3})(\d)/, '$1.$2');
                        value = value.replace(/(\d{3})(\d)/, '$1.$2');
                        value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                        e.target.value = value;
                    }
                });
            }

            if (phoneInput) {
                phoneInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length <= 11) {
                        value = value.replace(/(\d{2})(\d)/, '($1) $2');
                        value = value.replace(/(\d{5})(\d)/, '$1-$2');
                        e.target.value = value;
                    }
                });
            }
        }

        // Configurar eventos
        function setupEventListeners() {
            // Tabs de autenticação
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchAuthTab(tabName);
                });
            });

            // Login
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);

            // Formulário de caso
            document.getElementById('caseForm').addEventListener('submit', handleCaseSubmit);

            // Menu da sidebar
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    showPage(page);

                    // Atualizar item ativo
                    document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Toggle sidebar
            document.getElementById('toggleSidebar').addEventListener('click', toggleSidebar);

            // Filtro de relatório
            document.getElementById('reportPeriod').addEventListener('change', function() {
                document.getElementById('customDateRange').classList.toggle('d-none', this.value !== 'custom');
            });

            // Novos listeners
            document.getElementById('reportForm').addEventListener('submit', handleReportGenerate);
            document.getElementById('profileForm').addEventListener('submit', handleProfileUpdate);
            document.getElementById('passwordForm').addEventListener('submit', handlePasswordChange);
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileSidebar);
            document.getElementById('caseSearch').addEventListener('input', filterCases);
            document.getElementById('statusFilter').addEventListener('change', filterCases);
        }

        // Alternar entre abas de autenticação
        function switchAuthTab(tabName) {
            // Atualizar tabs ativas
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.toggle('active', tab.getAttribute('data-tab') === tabName);
            });

            // Mostrar formulário correspondente
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.toggle('active', form.id === tabName + 'Form');
            });
        }

        // Carregar dados do usuário do Firestore
        async function loadUserData() {
            if (!currentUser) return;

            try {
                const { doc, getDoc, setDoc } = window.firebase.firestore;
                const userDocRef = doc(window.firebase.firestore.getFirestore(), 'cadastro', currentUser.uid);
                const userDoc = await getDoc(userDocRef);

                if (userDoc.exists()) {
                    userData = userDoc.data();
                    cases = userData.cases || [];
                } else {
                    // Criar documento do usuário se não existir
                    userData = {
                        cpf: currentUser.cpf || '',
                        name: currentUser.displayName || currentUser.email.split('@')[0],
                        email: currentUser.email,
                        phone: currentUser.phone || '',
                        cases: [],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    await setDoc(userDocRef, userData);
                    cases = [];
                }

                showApp();
            } catch (error) {
                console.error('Erro ao carregar dados do usuário:', error);
                alert('Erro ao carregar dados. Tente novamente.');
            }
        }

        // Salvar dados do usuário no Firestore
        async function saveUserData() {
            if (!currentUser || !userData) return;

            try {
                const { doc, updateDoc } = window.firebase.firestore;
                const userDocRef = doc(window.firebase.firestore.getFirestore(), 'cadastro', currentUser.uid);
                
                userData.updatedAt = new Date().toISOString();
                userData.cases = cases;
                
                await updateDoc(userDocRef, userData);
            } catch (error) {
                console.error('Erro ao salvar dados do usuário:', error);
                alert('Erro ao salvar dados. Tente novamente.');
            }
        }

        // Mostrar tela de autenticação
        function showAuth() {
            document.getElementById('authPage').classList.remove('d-none');
            document.getElementById('app').classList.add('d-none');
        }

        // Mostrar aplicação
        function showApp() {
            document.getElementById('authPage').classList.add('d-none');
            document.getElementById('app').classList.remove('d-none');

            // Atualizar informações do usuário
            document.getElementById('userName').textContent = userData.name;
            document.getElementById('userAvatar').textContent = userData.name.charAt(0).toUpperCase();

            // Carregar dashboard
            showPage('dashboard');
        }

        // Manipular login
        async function handleLogin(e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            const loginText = document.getElementById('loginText');
            const loginLoading = document.getElementById('loginLoading');

            try {
                // Mostrar loading
                loginText.classList.add('d-none');
                loginLoading.classList.remove('d-none');
                loginBtn.disabled = true;

                const { signInWithEmailAndPassword } = window.firebase.auth;
                await signInWithEmailAndPassword(window.firebase.auth.getAuth(), email, password);
                
                // Login bem-sucedido - o onAuthStateChanged irá tratar o restante
            } catch (error) {
                console.error('Erro no login:', error);
                let errorMessage = 'Erro ao fazer login. Tente novamente.';
                
                if (error.code === 'auth/invalid-email') {
                    errorMessage = 'E-mail inválido.';
                } else if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Usuário não encontrado.';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Senha incorreta.';
                }
                
                alert(errorMessage);
            } finally {
                // Restaurar botão
                loginText.classList.remove('d-none');
                loginLoading.classList.add('d-none');
                loginBtn.disabled = false;
            }
        }

        // Manipular registro
        async function handleRegister(e) {
            e.preventDefault();

            const cpf = document.getElementById('registerCpf').value.replace(/\D/g, '');
            const email = document.getElementById('registerEmail').value;
            const name = document.getElementById('registerName').value;
            const phone = document.getElementById('registerPhone').value.replace(/\D/g, '');
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;

            // Validações
            if (cpf.length !== 11) {
                alert('CPF inválido! Digite um CPF válido com 11 dígitos.');
                return;
            }

            if (password !== confirmPassword) {
                alert('As senhas não coincidem!');
                return;
            }

            if (phone.length < 10) {
                alert('Telefone inválido! Digite um número válido.');
                return;
            }

            const registerBtn = document.getElementById('registerBtn');
            const registerText = document.getElementById('registerText');
            const registerLoading = document.getElementById('registerLoading');

            try {
                // Mostrar loading
                registerText.classList.add('d-none');
                registerLoading.classList.remove('d-none');
                registerBtn.disabled = true;

                const { createUserWithEmailAndPassword, updateProfile } = window.firebase.auth;
                const userCredential = await createUserWithEmailAndPassword(
                    window.firebase.auth.getAuth(), 
                    email, 
                    password
                );

                // Atualizar perfil do usuário
                await updateProfile(userCredential.user, {
                    displayName: name
                });

                // Salvar dados adicionais no Firestore
                const userData = {
                    cpf: cpf,
                    name: name,
                    email: email,
                    phone: phone,
                    cases: [],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                const { doc, setDoc } = window.firebase.firestore;
                await setDoc(doc(window.firebase.firestore.getFirestore(), 'cadastro', userCredential.user.uid), userData);

                // Limpar formulário
                document.getElementById('registerForm').reset();

                alert('Conta criada com sucesso! Faça login para continuar.');
                switchAuthTab('login');

            } catch (error) {
                console.error('Erro no registro:', error);
                let errorMessage = 'Erro ao criar conta. Tente novamente.';
                
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Este e-mail já está em uso.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'A senha deve ter pelo menos 6 caracteres.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'E-mail inválido.';
                }
                
                alert(errorMessage);
            } finally {
                // Restaurar botão
                registerText.classList.remove('d-none');
                registerLoading.classList.add('d-none');
                registerBtn.disabled = false;
            }
        }

        // Login com Google
        async function loginWithGoogle() {
            try {
                const { GoogleAuthProvider, signInWithPopup } = window.firebase.auth;
                const provider = new GoogleAuthProvider();
                await signInWithPopup(window.firebase.auth.getAuth(), provider);
            } catch (error) {
                console.error('Erro no login com Google:', error);
                alert('Erro ao fazer login com Google. Tente novamente.');
            }
        }

        // Login com Facebook
        async function loginWithFacebook() {
            try {
                const { FacebookAuthProvider, signInWithPopup } = window.firebase.auth;
                const provider = new FacebookAuthProvider();
                await signInWithPopup(window.firebase.auth.getAuth(), provider);
            } catch (error) {
                console.error('Erro no login com Facebook:', error);
                alert('Erro ao fazer login com Facebook. Tente novamente.');
            }
        }

        // Logout
        async function logout() {
            try {
                const { signOut } = window.firebase.auth;
                await signOut(window.firebase.auth.getAuth());
                currentUser = null;
                userData = null;
                cases = [];
                showAuth();
            } catch (error) {
                console.error('Erro no logout:', error);
                alert('Erro ao fazer logout. Tente novamente.');
            }
        }

        // Alternar sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const toggleIcon = document.getElementById('toggleSidebar').querySelector('i');

            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');

            if (sidebar.classList.contains('collapsed')) {
                toggleIcon.className = 'fas fa-chevron-right';
            } else {
                toggleIcon.className = 'fas fa-chevron-left';
            }
        }

        // Alternar sidebar mobile
        function toggleMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('mobile-open');
        }

        // Mostrar página específica
        function showPage(pageName, params = {}) {
            // Ocultar todas as páginas
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('d-none');
            });

            // Mostrar página solicitada
            document.getElementById(pageName + 'Page').classList.remove('d-none');

            // Atualizar dados se necessário
            if (pageName === 'dashboard') {
                updateDashboard();
            } else if (pageName === 'cases') {
                updateCasesTable();
            } else if (pageName === 'addCase') {
                setupCaseForm(params.caseId);
            } else if (pageName === 'clients') {
                updateClientsTable();
            } else if (pageName === 'reports') {
                updateReports();
            } else if (pageName === 'settings') {
                setupSettings();
            }
        }

        // Atualizar dashboard
        function updateDashboard() {
            const totalCases = cases.length;
            const resolvedCases = cases.filter(c => c.status === 'resolved' || c.status === 'agreed').length;
            const pendingCases = cases.filter(c => c.status === 'pending').length;
            const totalValue = cases.reduce((sum, c) => sum + (c.value || 0), 0);

            document.getElementById('totalCases').textContent = totalCases;
            document.getElementById('resolvedCases').textContent = resolvedCases;
            document.getElementById('pendingCases').textContent = pendingCases;
            document.getElementById('totalValue').textContent = `R$ ${totalValue.toFixed(2)}`;

            // Atualizar tabela de casos recentes
            const recentCasesTable = document.getElementById('recentCasesTable');
            recentCasesTable.innerHTML = '';

            const recentCases = cases
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);

            recentCases.forEach(caseItem => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${caseItem.title}</td>
                    <td>${caseItem.client}</td>
                    <td>R$ ${caseItem.value ? caseItem.value.toFixed(2) : '0.00'}</td>
                    <td><span class="status-badge status-${caseItem.status}">${getStatusText(caseItem.status)}</span></td>
                    <td>${formatDate(caseItem.date)}</td>
                `;
                recentCasesTable.appendChild(row);
            });
        }

        // Atualizar tabela de casos
        function updateCasesTable() {
            filterCases();
        }

        // Filtrar casos
        function filterCases() {
            const searchTerm = document.getElementById('caseSearch').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;

            const casesTable = document.getElementById('casesTable');
            casesTable.innerHTML = '';

            const filteredCases = cases.filter(c => {
                const matchesSearch = c.title.toLowerCase().includes(searchTerm) || 
                                     c.client.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusFilter || c.status === statusFilter;

                return matchesSearch && matchesStatus;
            });

            filteredCases.forEach(caseItem => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${caseItem.title}</td>
                    <td>${caseItem.client}</td>
                    <td>R$ ${caseItem.value ? caseItem.value.toFixed(2) : '0.00'}</td>
                    <td><span class="status-badge status-${caseItem.status}">${getStatusText(caseItem.status)}</span></td>
                    <td>${formatDate(caseItem.date)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-outline btn-sm" onclick="viewCase(${caseItem.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="editCaseForm(${caseItem.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteCase(${caseItem.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                casesTable.appendChild(row);
            });
        }

        // Configurar formulário de caso (novo ou edição)
        function setupCaseForm(caseId = null) {
            const formTitle = document.getElementById('caseFormTitle');
            const caseForm = document.getElementById('caseForm');

            if (caseId) {
                // Modo edição
                formTitle.textContent = 'Editar Caso';
                const caseItem = cases.find(c => c.id === caseId);
                if (caseItem) {
                    document.getElementById('caseId').value = caseItem.id;
                    document.getElementById('caseTitle').value = caseItem.title || '';
                    document.getElementById('caseDescription').value = caseItem.description || '';
                    document.getElementById('caseClient').value = caseItem.client || '';
                    document.getElementById('caseValue').value = caseItem.value || '';
                    document.getElementById('caseStatus').value = caseItem.status || 'pending';
                    document.getElementById('caseDate').value = caseItem.date || '';
                } else {
                    alert('Caso não encontrado!');
                    showPage('cases');
                }
            } else {
                // Modo novo caso
                formTitle.textContent = 'Novo Caso';
                caseForm.reset();
                document.getElementById('caseId').value = '';
                document.getElementById('caseDate').value = new Date().toISOString().split('T')[0];
            }
        }

        // Manipular envio do formulário de caso
        async function handleCaseSubmit(e) {
            e.preventDefault();

            const saveCaseBtn = document.getElementById('saveCaseBtn');
            const saveCaseText = document.getElementById('saveCaseText');
            const saveCaseLoading = document.getElementById('saveCaseLoading');

            try {
                // Mostrar loading
                saveCaseText.classList.add('d-none');
                saveCaseLoading.classList.remove('d-none');
                saveCaseBtn.disabled = true;

                const caseId = document.getElementById('caseId').value;
                const title = document.getElementById('caseTitle').value;
                const description = document.getElementById('caseDescription').value;
                const client = document.getElementById('caseClient').value;
                const value = parseFloat(document.getElementById('caseValue').value) || 0;
                const status = document.getElementById('caseStatus').value;
                const date = document.getElementById('caseDate').value;

                if (caseId) {
                    // Editar caso existente
                    const index = cases.findIndex(c => c.id === parseInt(caseId));
                    if (index !== -1) {
                        cases[index] = {
                            ...cases[index],
                            title,
                            description,
                            client,
                            value,
                            status,
                            date,
                            updatedAt: new Date().toISOString()
                        };
                    }
                } else {
                    // Criar novo caso
                    const newCase = {
                        id: cases.length > 0 ? Math.max(...cases.map(c => c.id)) + 1 : 1,
                        title,
                        description,
                        client,
                        value,
                        status,
                        date,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    cases.push(newCase);
                }

                // Salvar no Firestore
                await saveUserData();

                // Mostrar mensagem de sucesso
                alert('Caso salvo com sucesso!');

                // Voltar para a lista de casos
                showPage('cases');

            } catch (error) {
                console.error('Erro ao salvar caso:', error);
                alert('Erro ao salvar caso. Tente novamente.');
            } finally {
                // Restaurar botão
                saveCaseText.classList.remove('d-none');
                saveCaseLoading.classList.add('d-none');
                saveCaseBtn.disabled = false;
            }
        }

        // Visualizar caso
        function viewCase(caseId) {
            const caseItem = cases.find(c => c.id === caseId);
            if (!caseItem) return;

            document.getElementById('modalCaseTitle').textContent = caseItem.title;

            const modalContent = document.getElementById('modalCaseContent');
            modalContent.innerHTML = `
                <p><strong>Cliente:</strong> ${caseItem.client}</p>
                <p><strong>Valor:</strong> R$ ${caseItem.value ? caseItem.value.toFixed(2) : '0.00'}</p>
                <p><strong>Status:</strong> <span class="status-badge status-${caseItem.status}">${getStatusText(caseItem.status)}</span></p>
                <p><strong>Data de Criação:</strong> ${formatDate(caseItem.date)}</p>
                <p><strong>Descrição:</strong></p>
                <p>${caseItem.description}</p>
            `;

            // Armazenar ID do caso para possível edição
            modalContent.setAttribute('data-case-id', caseId);

            openModal('caseModal');
        }

        // Editar caso a partir do modal
        function editCase() {
            const caseId = document.getElementById('modalCaseContent').getAttribute('data-case-id');
            closeModal('caseModal');
            editCaseForm(parseInt(caseId));
        }

        // Abrir formulário de edição
        function editCaseForm(caseId) {
            showPage('addCase', {caseId: caseId});
        }

        // Excluir caso
        async function deleteCase(caseId) {
            if (confirm('Tem certeza que deseja excluir este caso?')) {
                try {
                    cases = cases.filter(c => c.id !== caseId);
                    await saveUserData();
                    updateCasesTable();
                    alert('Caso excluído com sucesso!');
                } catch (error) {
                    console.error('Erro ao excluir caso:', error);
                    alert('Erro ao excluir caso. Tente novamente.');
                }
            }
        }

        // Atualizar tabela de clientes
        function updateClientsTable() {
            const clientsTable = document.getElementById('clientsTable');
            clientsTable.innerHTML = '';

            // Extrair clientes únicos dos casos
            const clientsMap = new Map();

            cases.forEach(caseItem => {
                if (!clientsMap.has(caseItem.client)) {
                    clientsMap.set(caseItem.client, {
                        name: caseItem.client,
                        email: `${caseItem.client.replace(/\s+/g, '').toLowerCase()}@exemplo.com`,
                        phone: '(11) 9' + Math.floor(10000000 + Math.random() * 90000000),
                        activeCases: 0
                    });
                }
                const client = clientsMap.get(caseItem.client);
                if (caseItem.status === 'pending' || caseItem.status === 'in-progress') {
                    client.activeCases++;
                }
            });

            clientsMap.forEach(client => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${client.name}</td>
                    <td>${client.email}</td>
                    <td>${client.phone}</td>
                    <td>${client.activeCases}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-outline btn-sm" onclick="viewClientEmail('${client.email}')">
                                <i class="fas fa-envelope"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="viewClientPhone('${client.phone}')">
                                <i class="fas fa-phone"></i>
                            </button>
                        </div>
                    </td>
                `;
                clientsTable.appendChild(row);
            });
        }

        // Funções para visualizar e-mail e telefone do cliente
        function viewClientEmail(email) {
            alert(`E-mail do cliente: ${email}`);
        }

        function viewClientPhone(phone) {
            alert(`Telefone do cliente: ${phone}`);
        }

        // Atualizar relatórios
        function updateReports() {
            const totalCases = cases.length;
            const resolvedCases = cases.filter(c => c.status === 'resolved' || c.status === 'agreed').length;
            const pendingCases = cases.filter(c => c.status === 'pending').length;
            const totalValue = cases.reduce((sum, c) => sum + (c.value || 0), 0);

            document.getElementById('reportTotalCases').textContent = totalCases;
            document.getElementById('reportResolvedCases').textContent = resolvedCases;
            document.getElementById('reportPendingCases').textContent = pendingCases;
            document.getElementById('reportTotalValue').textContent = `R$ ${totalValue.toFixed(2)}`;
        }

        // Manipular geração de relatório
        function handleReportGenerate(e) {
            e.preventDefault();
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const type = document.getElementById('reportType').value;
            const period = document.getElementById('reportPeriod').value;
            let startDate, endDate;

            if (period === 'custom') {
                startDate = new Date(document.getElementById('startDate').value);
                endDate = new Date(document.getElementById('endDate').value);
            } else {
                endDate = new Date();
                if (period === 'month') {
                    startDate = new Date(endDate.getFullYear(), endDate.getMonth(), 1);
                } else if (period === 'quarter') {
                    startDate = new Date(endDate.getFullYear(), Math.floor(endDate.getMonth() / 3) * 3, 1);
                } else if (period === 'year') {
                    startDate = new Date(endDate.getFullYear(), 0, 1);
                } else {
                    startDate = new Date(0); // Todo o período
                }
            }

            const filteredCases = cases.filter(c => {
                const caseDate = new Date(c.date);
                return caseDate >= startDate && caseDate <= endDate;
            });

            let yPos = 10;
            doc.text(`Relatório de ${type} para o período: ${formatDate(startDate)} a ${formatDate(endDate)}`, 10, yPos);
            yPos += 10;

            if (type === 'cases') {
                const pending = filteredCases.filter(c => c.status === 'pending').length;
                const inProgress = filteredCases.filter(c => c.status === 'in-progress').length;
                const resolved = filteredCases.filter(c => c.status === 'resolved').length;
                const agreed = filteredCases.filter(c => c.status === 'agreed').length;
                doc.text(`Pendentes: ${pending}`, 10, yPos);
                yPos += 10;
                doc.text(`Em andamento: ${inProgress}`, 10, yPos);
                yPos += 10;
                doc.text(`Resolvidos: ${resolved}`, 10, yPos);
                yPos += 10;
                doc.text(`Acordados: ${agreed}`, 10, yPos);
            } else if (type === 'financial') {
                const totalValue = filteredCases.reduce((sum, c) => sum + (c.value || 0), 0);
                doc.text(`Valor Total: R$ ${totalValue.toFixed(2)}`, 10, yPos);
            } else if (type === 'clients') {
                const clientsMap = new Map();
                filteredCases.forEach(c => {
                    clientsMap.set(c.client, (clientsMap.get(c.client) || 0) + 1);
                });
                clientsMap.forEach((count, client) => {
                    doc.text(`${client}: ${count} casos`, 10, yPos);
                    yPos += 10;
                });
            }

            doc.save('relatorio.pdf');
        }

        // Configurar página de configurações
        function setupSettings() {
            document.getElementById('userNameInput').value = userData.name || '';
            document.getElementById('userEmail').value = userData.email || '';
            document.getElementById('userPhone').value = userData.phone || '';
        }

        // Manipular atualização de perfil
        async function handleProfileUpdate(e) {
            e.preventDefault();
            
            try {
                const name = document.getElementById('userNameInput').value;
                const email = document.getElementById('userEmail').value;
                const phone = document.getElementById('userPhone').value;

                userData.name = name;
                userData.email = email;
                userData.phone = phone;

                await saveUserData();

                document.getElementById('userName').textContent = name;
                document.getElementById('userAvatar').textContent = name.charAt(0).toUpperCase();

                alert('Perfil atualizado com sucesso!');
            } catch (error) {
                console.error('Erro ao atualizar perfil:', error);
                alert('Erro ao atualizar perfil. Tente novamente.');
            }
        }

        // Manipular alteração de senha
        async function handlePasswordChange(e) {
            e.preventDefault();
            alert('Funcionalidade de alteração de senha será implementada em breve.');
        }

        // Abrir modal
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        // Fechar modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Obter texto do status
        function getStatusText(status) {
            const statusMap = {
                'pending': 'Pendente',
                'in-progress': 'Em andamento',
                'resolved': 'Resolvido',
                'agreed': 'Acordado'
            };
            return statusMap[status] || status;
        }

        // Formatar data
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            return new Date(dateString).toLocaleDateString('pt-BR', options);
        }
    </script>
</body>
</html>
