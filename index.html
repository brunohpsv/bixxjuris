<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bixx Acordos - Gestão Simplificada de Casos Jurídicos</title>
    <title>BIXXJURIS - Gestão Simplificada de Casos Jurídicos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Variáveis CSS para cores */
        :root {
            --primary: #1E3A8A;
            --secondary: #16A34A;
            --neutral: #6B7280;
            --accent: #F97316;
            --light: #F9FAFB;
            --dark: #1F2937;
            --danger: #EF4444;
            --warning: #F59E0B;
        }

        /* Reset e estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }

        /* Layout principal */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--primary);
            color: white;
            transition: all 0.3s ease;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .sidebar-menu {
            padding: 15px 0;
        }

        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-left: 4px solid var(--accent);
        }

        .menu-item i {
            margin-right: 10px;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .menu-text {
            transition: opacity 0.3s;
        }

        .sidebar.collapsed .menu-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }

        .toggle-sidebar {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* Conteúdo principal */
        .main-content {
            flex: 1;
            margin-left: 250px;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 70px;
        }

        /* Header */
        .header {
            background-color: white;
            padding: 15px 30px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Conteúdo das páginas */
        .page-content {
            padding: 30px;
        }

        .page-title {
            margin-bottom: 20px;
            color: var(--primary);
            font-size: 1.8rem;
        }

        /* Cards de dashboard */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        .stat-card i {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-card.primary i { color: var(--primary); }
        .stat-card.secondary i { color: var(--secondary); }
        .stat-card.accent i { color: var(--accent); }
        .stat-card.neutral i { color: var(--neutral); }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .stat-label {
            color: var(--neutral);
            font-size: 0.9rem;
        }

        /* Tabelas */
        .table-container {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: #f8fafc;
            color: var(--primary);
            font-weight: 600;
        }

        tr:hover {
            background-color: #f9fafb;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending { background-color: #FEF3C7; color: #92400E; }
        .status-in-progress { background-color: #DBEAFE; color: #1E40AF; }
        .status-resolved { background-color: #D1FAE5; color: #065F46; }
        .status-agreed { background-color: #E0E7FF; color: #3730A3; }

        /* Formulários */
        .form-container {
            background-color: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Botões */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #172554;
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #15803d;
        }

        .btn-accent {
            background-color: var(--accent);
            color: white;
        }

        .btn-accent:hover {
            background-color: #ea580c;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--neutral);
            color: var(--dark);
        }

        .btn-outline:hover {
            background-color: #f3f4f6;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.9rem;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            padding: 25px;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--neutral);
        }

        /* Login */
        .login-container {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, #3B82F6 100%);
        }

        .login-box {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            padding: 30px;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo h1 {
            color: var(--primary);
            font-size: 2rem;
        }

        .login-logo p {
            color: var(--neutral);
            font-size: 0.9rem;
        }

        .social-login {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .social-btn {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .social-btn:hover {
            background-color: #f9fafb;
        }

        .divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }

        .divider::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background-color: #eee;
        }

        .divider span {
            background-color: white;
            padding: 0 15px;
            color: var(--neutral);
            font-size: 0.9rem;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }

            .sidebar .menu-text {
                opacity: 0;
                width: 0;
                overflow: hidden;
            }

            .main-content {
                margin-left: 70px;
            }

            .stats-cards {
                grid-template-columns: 1fr;
            }

            .header {
                padding: 15px;
            }

            .page-content {
                padding: 15px;
            }
        }

        @media (max-width: 576px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-menu-btn {
                display: block;
            }
        }

        /* Utilitários */
        .text-center { text-align: center; }
        .mb-20 { margin-bottom: 20px; }
        .mt-20 { margin-top: 20px; }
        .d-none { display: none; }
        .d-flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .align-center { align-items: center; }
        .w-100 { width: 100%; }

        /* Animações */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <h1>Bixx Acordos</h1>
                <h1>BIXXJURIS</h1>
                <p>Gestão simplificada de casos jurídicos</p>
            </div>

            <div class="social-login">
                <button class="social-btn" onclick="loginWithGoogle()">
                    <i class="fab fa-google"></i> Google
                </button>
                <button class="social-btn" onclick="loginWithFacebook()">
                    <i class="fab fa-facebook"></i> Facebook
                </button>
            </div>

            <div class="divider">
                <span>ou</span>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="email">E-mail</label>
                    <input type="email" id="email" required>
                </div>

                <div class="form-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" required>
                </div>

                <button type="submit" class="btn btn-primary w-100">Entrar</button>
            </form>

            <div class="text-center mt-20">
                <p>Não tem uma conta? <a href="#" onclick="showRegisterForm()">Cadastre-se</a></p>
            </div>
        </div>
    </div>

    <!-- Aplicação Principal -->
    <div id="app" class="app-container d-none">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>Bixx Acordos</h1>
                <h1>BIXXJURIS</h1>
                <p>Gestão Jurídica</p>
            </div>

            <div class="sidebar-menu">
                <div class="menu-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="menu-text">Dashboard</span>
                </div>

                <div class="menu-item" data-page="cases">
                    <i class="fas fa-folder"></i>
                    <span class="menu-text">Meus Casos</span>
                </div>

                <div class="menu-item" data-page="addCase">
                    <i class="fas fa-plus-circle"></i>
                    <span class="menu-text">Novo Caso</span>
                </div>

                <div class="menu-item" data-page="clients">
                    <i class="fas fa-users"></i>
                    <span class="menu-text">Clientes</span>
                </div>

                <div class="menu-item" data-page="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span class="menu-text">Relatórios</span>
                </div>

                <div class="menu-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span class="menu-text">Configurações</span>
                </div>
            </div>

            <button class="toggle-sidebar" id="toggleSidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>

        <!-- Conteúdo Principal -->
        <div class="main-content" id="mainContent">
            <!-- Header -->
            <div class="header">
                <div>
                    <button class="btn btn-outline mobile-menu-btn d-none" id="mobileMenuBtn">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>

                <div class="user-info">
                    <span id="userName">Usuário</span>
                    <div class="user-avatar" id="userAvatar">U</div>
                    <button class="btn btn-outline btn-sm" onclick="logout()">Sair</button>
                </div>
            </div>

            <!-- Conteúdo das Páginas -->
            <div class="page-content">
                <!-- Página: Dashboard -->
                <div id="dashboardPage" class="page">
                    <h2 class="page-title">Dashboard</h2>

                    <div class="stats-cards">
                        <div class="stat-card primary">
                            <i class="fas fa-folder"></i>
                            <div class="stat-value" id="totalCases">0</div>
                            <div class="stat-label">Total de Casos</div>
                        </div>

                        <div class="stat-card secondary">
                            <i class="fas fa-check-circle"></i>
                            <div class="stat-value" id="resolvedCases">0</div>
                            <div class="stat-label">Casos Resolvidos</div>
                        </div>

                        <div class="stat-card accent">
                            <i class="fas fa-clock"></i>
                            <div class="stat-value" id="pendingCases">0</div>
                            <div class="stat-label">Casos Pendentes</div>
                        </div>

                        <div class="stat-card neutral">
                            <i class="fas fa-dollar-sign"></i>
                            <div class="stat-value" id="totalValue">R$ 0</div>
                            <div class="stat-label">Valor Total</div>
                        </div>
                    </div>

                    <h3>Casos Recentes</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Título</th>
                                    <th>Cliente</th>
                                    <th>Valor</th>
                                    <th>Status</th>
                                    <th>Data</th>
                                </tr>
                            </thead>
                            <tbody id="recentCasesTable">
                                <!-- Dados serão preenchidos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Página: Meus Casos -->
                <div id="casesPage" class="page d-none">
                    <div class="d-flex justify-between align-center mb-20">
                        <h2 class="page-title">Meus Casos</h2>
                        <button class="btn btn-primary" onclick="showPage('addCase')">
                            <i class="fas fa-plus"></i> Novo Caso
                        </button>
                    </div>

                    <div class="filters mb-20">
                        <div class="d-flex" style="gap: 10px;">
                            <input type="text" id="caseSearch" placeholder="Buscar caso..." style="flex: 1;">
                            <select id="statusFilter">
                                <option value="">Todos os status</option>
                                <option value="pending">Pendente</option>
                                <option value="in-progress">Em andamento</option>
                                <option value="resolved">Resolvido</option>
                                <option value="agreed">Acordado</option>
                            </select>
                            <button class="btn btn-outline" onclick="filterCases()">
                                <i class="fas fa-filter"></i> Filtrar
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Título</th>
                                    <th>Cliente</th>
                                    <th>Valor</th>
                                    <th>Status</th>
                                    <th>Data de Criação</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="casesTable">
                                <!-- Dados serão preenchidos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Página: Adicionar/Editar Caso -->
                <div id="addCasePage" class="page d-none">
                    <h2 class="page-title" id="caseFormTitle">Novo Caso</h2>

                    <div class="form-container">
                        <form id="caseForm">
                            <input type="hidden" id="caseId">

                            <div class="form-group">
                                <label for="caseTitle">Título do Caso</label>
                                <input type="text" id="caseTitle" required>
                            </div>

                            <div class="form-group">
                                <label for="caseDescription">Descrição</label>
                                <textarea id="caseDescription" required></textarea>
                            </div>

                            <div class="form-group">
                                <label for="caseClient">Cliente/Parte Envolvida</label>
                                <input type="text" id="caseClient" required>
                            </div>

                            <div class="form-group">
                                <label for="caseValue">Valor (R$)</label>
                                <input type="number" id="caseValue" step="0.01" min="0">
                            </div>

                            <div class="form-group">
                                <label for="caseStatus">Status</label>
                                <select id="caseStatus" required>
                                    <option value="pending">Pendente</option>
                                    <option value="in-progress">Em andamento</option>
                                    <option value="resolved">Resolvido</option>
                                    <option value="agreed">Acordado</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="caseDate">Data de Criação</label>
                                <input type="date" id="caseDate" required>
                            </div>

                            <div class="form-group">
                                <label for="caseFile">Anexar Documento (opcional)</label>
                                <input type="file" id="caseFile">
                            </div>

                            <div class="action-buttons">
                                <button type="submit" class="btn btn-primary">Salvar Caso</button>
                                <button type="button" class="btn btn-outline" onclick="showPage('cases')">Cancelar</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Página: Clientes -->
                <div id="clientsPage" class="page d-none">
                    <h2 class="page-title">Clientes</h2>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>E-mail</th>
                                    <th>Telefone</th>
                                    <th>Casos Ativos</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="clientsTable">
                                <!-- Dados serão preenchidos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Página: Relatórios -->
                <div id="reportsPage" class="page d-none">
                    <h2 class="page-title">Relatórios</h2>

                    <div class="stats-cards">
                        <div class="stat-card primary">
                            <i class="fas fa-chart-line"></i>
                            <div class="stat-value" id="reportTotalCases">0</div>
                            <div class="stat-label">Total de Casos</div>
                        </div>

                        <div class="stat-card secondary">
                            <i class="fas fa-check-circle"></i>
                            <div class="stat-value" id="reportResolvedCases">0</div>
                            <div class="stat-label">Resolvidos</div>
                        </div>

                        <div class="stat-card accent">
                            <i class="fas fa-clock"></i>
                            <div class="stat-value" id="reportPendingCases">0</div>
                            <div class="stat-label">Pendentes</div>
                        </div>

                        <div class="stat-card neutral">
                            <i class="fas fa-dollar-sign"></i>
                            <div class="stat-value" id="reportTotalValue">R$ 0</div>
                            <div class="stat-label">Valor Total</div>
                        </div>
                    </div>

                    <div class="form-container">
                        <h3>Gerar Relatório</h3>
                        <form id="reportForm">
                            <div class="form-group">
                                <label for="reportType">Tipo de Relatório</label>
                                <select id="reportType">
                                    <option value="cases">Casos por Status</option>
                                    <option value="financial">Financeiro</option>
                                    <option value="clients">Casos por Cliente</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="reportPeriod">Período</label>
                                <select id="reportPeriod">
                                    <option value="all">Todo o período</option>
                                    <option value="month">Este mês</option>
                                    <option value="quarter">Este trimestre</option>
                                    <option value="year">Este ano</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </div>

                            <div class="form-group d-none" id="customDateRange">
                                <div class="d-flex" style="gap: 10px;">
                                    <div style="flex: 1;">
                                        <label for="startDate">Data Inicial</label>
                                        <input type="date" id="startDate">
                                    </div>
                                    <div style="flex: 1;">
                                        <label for="endDate">Data Final</label>
                                        <input type="date" id="endDate">
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-download"></i> Gerar Relatório
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Página: Configurações -->
                <div id="settingsPage" class="page d-none">
                    <h2 class="page-title">Configurações</h2>

                    <div class="form-container">
                        <h3>Perfil do Usuário</h3>
                        <form id="profileForm">
                            <div class="form-group">
                                <label for="userNameInput">Nome Completo</label>
                                <input type="text" id="userNameInput" required>
                            </div>

                            <div class="form-group">
                                <label for="userEmail">E-mail</label>
                                <input type="email" id="userEmail" required>
                            </div>

                            <div class="form-group">
                                <label for="userPhone">Telefone</label>
                                <input type="tel" id="userPhone">
                            </div>

                            <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                        </form>

                        <hr style="margin: 30px 0;">

                        <h3>Alterar Senha</h3>
                        <form id="passwordForm">
                            <div class="form-group">
                                <label for="currentPassword">Senha Atual</label>
                                <input type="password" id="currentPassword">
                            </div>

                            <div class="form-group">
                                <label for="newPassword">Nova Senha</label>
                                <input type="password" id="newPassword">
                            </div>

                            <div class="form-group">
                                <label for="confirmPassword">Confirmar Nova Senha</label>
                                <input type="password" id="confirmPassword">
                            </div>

                            <button type="submit" class="btn btn-primary">Alterar Senha</button>
                        </form>

                        <hr style="margin: 30px 0;">

                        <h3>Assinatura</h3>
                        <div class="d-flex justify-between align-center">
                            <div>
                                <p><strong>Plano Atual:</strong> Básico - R$ 50,00/mês</p>
                                <p>Próxima cobrança: <span id="nextBillingDate">01/12/2023</span></p>
                            </div>
                            <button class="btn btn-outline">Alterar Plano</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para visualizar/editar caso -->
    <div class="modal" id="caseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalCaseTitle">Detalhes do Caso</h3>
                <button class="close-modal" onclick="closeModal('caseModal')">&times;</button>
            </div>

            <div id="modalCaseContent">
                <!-- Conteúdo será preenchidos via JavaScript -->
            </div>

            <div class="action-buttons mt-20">
                <button class="btn btn-primary" onclick="editCase()">Editar</button>
                <button class="btn btn-outline" onclick="closeModal('caseModal')">Fechar</button>
            </div>
        </div>
    </div>

    <script>
        // Dados de exemplo (em produção, isso viria de um backend)
        let currentUser = null;
        let cases = JSON.parse(localStorage.getItem('cases')) || [];
        let users = JSON.parse(localStorage.getItem('users')) || [
            { id: 1, name: "João Silva", email: "joao@exemplo.com", password: "123456" }
        ];

        // Inicialização da aplicação
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se há um usuário logado
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showApp();
            } else {
                showLogin();
            }

            // Configurar eventos
            setupEventListeners();

            // Inicializar dados de exemplo se necessário
            if (cases.length === 0) {
                initializeSampleData();
            }
        });

        // Configurar eventos
        function setupEventListeners() {
            // Login
            document.getElementById('loginForm').addEventListener('submit', handleLogin);

            // Formulário de caso
            document.getElementById('caseForm').addEventListener('submit', handleCaseSubmit);

            // Menu da sidebar
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    showPage(page);

                    // Atualizar item ativo
                    document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Toggle sidebar
            document.getElementById('toggleSidebar').addEventListener('click', toggleSidebar);

            // Filtro de relatório
            document.getElementById('reportPeriod').addEventListener('change', function() {
                document.getElementById('customDateRange').classList.toggle('d-none', this.value !== 'custom');
            });

            // Novos listeners
            document.getElementById('reportForm').addEventListener('submit', handleReportGenerate);
            document.getElementById('profileForm').addEventListener('submit', handleProfileUpdate);
            document.getElementById('passwordForm').addEventListener('submit', handlePasswordChange);
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileSidebar);
            document.getElementById('caseSearch').addEventListener('input', filterCases);
            document.getElementById('statusFilter').addEventListener('change', filterCases);
        }

        // Inicializar dados de exemplo
        function initializeSampleData() {
            cases = [
                {
                    id: 1,
                    title: "Caso de Divórcio Consensual",
                    description: "Processo de divórcio consensual entre as partes.",
                    client: "Maria Santos",
                    value: 2500.00,
                    status: "resolved",
                    date: "2023-10-15",
                    userId: 1
                },
                {
                    id: 2,
                    title: "Contrato de Prestação de Serviços",
                    description: "Elaboração de contrato para empresa de tecnologia.",
                    client: "Tech Solutions Ltda",
                    value: 1500.00,
                    status: "in-progress",
                    date: "2023-11-05",
                    userId: 1
                },
                {
                    id: 3,
                    title: "Ação de Cobrança",
                    description: "Cobrança judicial de dívida comercial.",
                    client: "Comércio Express",
                    value: 3500.00,
                    status: "pending",
                    date: "2023-11-10",
                    userId: 1
                },
                {
                    id: 4,
                    title: "Acordo Trabalhista",
                    description: "Negociação de acordo em processo trabalhista.",
                    client: "José Oliveira",
                    value: 4200.00,
                    status: "agreed",
                    date: "2023-11-12",
                    userId: 1
                }
            ];

            localStorage.setItem('cases', JSON.stringify(cases));
        }

        // Mostrar tela de login
        function showLogin() {
            document.getElementById('loginPage').classList.remove('d-none');
            document.getElementById('app').classList.add('d-none');
        }

        // Mostrar aplicação
        function showApp() {
            document.getElementById('loginPage').classList.add('d-none');
            document.getElementById('app').classList.remove('d-none');

            // Atualizar informações do usuário
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();

            // Carregar dashboard
            showPage('dashboard');
        }

        // Manipular login
        function handleLogin(e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            // Verificar credenciais (em produção, isso seria feito no backend)
            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                showApp();
            } else {
                alert('E-mail ou senha incorretos!');
            }
        }

        // Login com Google (simulação)
        function loginWithGoogle() {
            // Em produção, integrar com API do Google
            currentUser = {
                id: 2,
                name: "Usuário Google",
                email: "googleuser@exemplo.com"
            };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showApp();
        }

        // Login com Facebook (simulação)
        function loginWithFacebook() {
            // Em produção, integrar com API do Facebook
            currentUser = {
                id: 3,
                name: "Usuário Facebook",
                email: "facebookuser@exemplo.com"
            };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showApp();
        }

        // Mostrar formulário de registro
        function showRegisterForm() {
            alert('Funcionalidade de registro será implementada em versão futura.');
        }

        // Logout
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showLogin();
        }

        // Alternar sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const toggleIcon = document.getElementById('toggleSidebar').querySelector('i');

            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');

            if (sidebar.classList.contains('collapsed')) {
                toggleIcon.className = 'fas fa-chevron-right';
            } else {
                toggleIcon.className = 'fas fa-chevron-left';
            }
        }

        // Alternar sidebar mobile
        function toggleMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('mobile-open');
        }

        // Mostrar página específica
        function showPage(pageName, params = {}) {
            // Ocultar todas as páginas
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('d-none');
            });

            // Mostrar página solicitada
            document.getElementById(pageName + 'Page').classList.remove('d-none');

            // Atualizar dados se necessário
            if (pageName === 'dashboard') {
                updateDashboard();
            } else if (pageName === 'cases') {
                updateCasesTable();
            } else if (pageName === 'addCase') {
                setupCaseForm(params.caseId);
            } else if (pageName === 'clients') {
                updateClientsTable();
            } else if (pageName === 'reports') {
                updateReports();
            } else if (pageName === 'settings') {
                setupSettings();
            }
        }

        // Atualizar dashboard
        function updateDashboard() {
            const userCases = cases.filter(c => c.userId === currentUser.id);
            const totalCases = userCases.length;
            const resolvedCases = userCases.filter(c => c.status === 'resolved' || c.status === 'agreed').length;
            const pendingCases = userCases.filter(c => c.status === 'pending').length;
            const totalValue = userCases.reduce((sum, c) => sum + (c.value || 0), 0);

            document.getElementById('totalCases').textContent = totalCases;
            document.getElementById('resolvedCases').textContent = resolvedCases;
            document.getElementById('pendingCases').textContent = pendingCases;
            document.getElementById('totalValue').textContent = `R$ ${totalValue.toFixed(2)}`;

            // Atualizar tabela de casos recentes
            const recentCasesTable = document.getElementById('recentCasesTable');
            recentCasesTable.innerHTML = '';

            const recentCases = userCases
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);

            recentCases.forEach(caseItem => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${caseItem.title}</td>
                    <td>${caseItem.client}</td>
                    <td>R$ ${caseItem.value ? caseItem.value.toFixed(2) : '0.00'}</td>
                    <td><span class="status-badge status-${caseItem.status}">${getStatusText(caseItem.status)}</span></td>
                    <td>${formatDate(caseItem.date)}</td>
                `;
                recentCasesTable.appendChild(row);
            });
        }

        // Atualizar tabela de casos
        function updateCasesTable() {
            filterCases(); // Chama o filtro para atualizar com os valores atuais
        }

        // Filtrar casos
        function filterCases() {
            const searchTerm = document.getElementById('caseSearch').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;

            const casesTable = document.getElementById('casesTable');
            casesTable.innerHTML = '';

            const userCases = cases.filter(c => c.userId === currentUser.id);
            const filteredCases = userCases.filter(c => {
                const matchesSearch = c.title.toLowerCase().includes(searchTerm) || 
                                     c.client.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusFilter || c.status === statusFilter;

                return matchesSearch && matchesStatus;
            });

            filteredCases.forEach(caseItem => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${caseItem.title}</td>
                    <td>${caseItem.client}</td>
                    <td>R$ ${caseItem.value ? caseItem.value.toFixed(2) : '0.00'}</td>
                    <td><span class="status-badge status-${caseItem.status}">${getStatusText(caseItem.status)}</span></td>
                    <td>${formatDate(caseItem.date)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-outline btn-sm" onclick="viewCase(${caseItem.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="editCaseForm(${caseItem.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteCase(${caseItem.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                casesTable.appendChild(row);
            });
        }

        // Configurar formulário de caso (novo ou edição)
        function setupCaseForm(caseId = null) {
            const formTitle = document.getElementById('caseFormTitle');
            const caseForm = document.getElementById('caseForm');

            if (caseId) {
                // Modo edição
                formTitle.textContent = 'Editar Caso';
                const caseItem = cases.find(c => c.id === caseId);
                if (caseItem) {
                    document.getElementById('caseId').value = caseItem.id;
                    document.getElementById('caseTitle').value = caseItem.title || '';
                    document.getElementById('caseDescription').value = caseItem.description || '';
                    document.getElementById('caseClient').value = caseItem.client || '';
                    document.getElementById('caseValue').value = caseItem.value || '';
                    document.getElementById('caseStatus').value = caseItem.status || 'pending';
                    document.getElementById('caseDate').value = caseItem.date || '';
                } else {
                    alert('Caso não encontrado!');
                    showPage('cases');
                }
            } else {
                // Modo novo caso
                formTitle.textContent = 'Novo Caso';
                caseForm.reset();
                document.getElementById('caseId').value = '';
                document.getElementById('caseDate').value = new Date().toISOString().split('T')[0];
            }
        }

        // Manipular envio do formulário de caso
        function handleCaseSubmit(e) {
            e.preventDefault();

            const caseId = document.getElementById('caseId').value;
            const title = document.getElementById('caseTitle').value;
            const description = document.getElementById('caseDescription').value;
            const client = document.getElementById('caseClient').value;
            const value = parseFloat(document.getElementById('caseValue').value) || 0;
            const status = document.getElementById('caseStatus').value;
            const date = document.getElementById('caseDate').value;

            if (caseId) {
                // Editar caso existente
                const index = cases.findIndex(c => c.id === parseInt(caseId));
                if (index !== -1) {
                    cases[index] = {
                        ...cases[index],
                        title,
                        description,
                        client,
                        value,
                        status,
                        date
                    };
                }
            } else {
                // Criar novo caso
                const newCase = {
                    id: cases.length > 0 ? Math.max(...cases.map(c => c.id)) + 1 : 1,
                    title,
                    description,
                    client,
                    value,
                    status,
                    date,
                    userId: currentUser.id
                };
                cases.push(newCase);
            }

            // Salvar no localStorage
            localStorage.setItem('cases', JSON.stringify(cases));

            // Mostrar mensagem de sucesso
            alert('Caso salvo com sucesso!');

            // Voltar para a lista de casos
            showPage('cases');
        }

        // Visualizar caso
        function viewCase(caseId) {
            const caseItem = cases.find(c => c.id === caseId);
            if (!caseItem) return;

            document.getElementById('modalCaseTitle').textContent = caseItem.title;

            const modalContent = document.getElementById('modalCaseContent');
            modalContent.innerHTML = `
                <p><strong>Cliente:</strong> ${caseItem.client}</p>
                <p><strong>Valor:</strong> R$ ${caseItem.value ? caseItem.value.toFixed(2) : '0.00'}</p>
                <p><strong>Status:</strong> <span class="status-badge status-${caseItem.status}">${getStatusText(caseItem.status)}</span></p>
                <p><strong>Data de Criação:</strong> ${formatDate(caseItem.date)}</p>
                <p><strong>Descrição:</strong></p>
                <p>${caseItem.description}</p>
            `;

            // Armazenar ID do caso para possível edição
            modalContent.setAttribute('data-case-id', caseId);

            openModal('caseModal');
        }

        // Editar caso a partir do modal
        function editCase() {
            const caseId = document.getElementById('modalCaseContent').getAttribute('data-case-id');
            closeModal('caseModal');
            editCaseForm(parseInt(caseId));
        }

        // Abrir formulário de edição
        function editCaseForm(caseId) {
            showPage('addCase', {caseId: caseId});
        }

        // Excluir caso
        function deleteCase(caseId) {
            if (confirm('Tem certeza que deseja excluir este caso?')) {
                cases = cases.filter(c => c.id !== caseId);
                localStorage.setItem('cases', JSON.stringify(cases));
                updateCasesTable();
            }
        }

        // Atualizar tabela de clientes
        function updateClientsTable() {
            const clientsTable = document.getElementById('clientsTable');
            clientsTable.innerHTML = '';

            // Extrair clientes únicos dos casos
            const clientsMap = new Map();
            const userCases = cases.filter(c => c.userId === currentUser.id);

            userCases.forEach(caseItem => {
                if (!clientsMap.has(caseItem.client)) {
                    clientsMap.set(caseItem.client, {
                        name: caseItem.client,
                        email: `${caseItem.client.replace(/\s+/g, '').toLowerCase()}@exemplo.com`,
                        phone: '(11) 9' + Math.floor(10000000 + Math.random() * 90000000), // Telefone fixo gerado uma vez
                        activeCases: 0
                    });
                }
                const client = clientsMap.get(caseItem.client);
                if (caseItem.status === 'pending' || caseItem.status === 'in-progress') {
                    client.activeCases++;
                }
            });

            clientsMap.forEach(client => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${client.name}</td>
                    <td>${client.email}</td>
                    <td>${client.phone}</td>
                    <td>${client.activeCases}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-outline btn-sm" onclick="viewClientEmail('${client.email}')">
                                <i class="fas fa-envelope"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="viewClientPhone('${client.phone}')">
                                <i class="fas fa-phone"></i>
                            </button>
                        </div>
                    </td>
                `;
                clientsTable.appendChild(row);
            });
        }

        // Funções para visualizar e-mail e telefone do cliente
        function viewClientEmail(email) {
            alert(`E-mail do cliente: ${email}`);
        }

        function viewClientPhone(phone) {
            alert(`Telefone do cliente: ${phone}`);
        }

        // Atualizar relatórios
        function updateReports() {
            const userCases = cases.filter(c => c.userId === currentUser.id);
            const totalCases = userCases.length;
            const resolvedCases = userCases.filter(c => c.status === 'resolved' || c.status === 'agreed').length;
            const pendingCases = userCases.filter(c => c.status === 'pending').length;
            const totalValue = userCases.reduce((sum, c) => sum + (c.value || 0), 0);

            document.getElementById('reportTotalCases').textContent = totalCases;
            document.getElementById('reportResolvedCases').textContent = resolvedCases;
            document.getElementById('reportPendingCases').textContent = pendingCases;
            document.getElementById('reportTotalValue').textContent = `R$ ${totalValue.toFixed(2)}`;
        }

        // Manipular geração de relatório
        function handleReportGenerate(e) {
            e.preventDefault();
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const type = document.getElementById('reportType').value;
            const period = document.getElementById('reportPeriod').value;
            let startDate, endDate;

            if (period === 'custom') {
                startDate = new Date(document.getElementById('startDate').value);
                endDate = new Date(document.getElementById('endDate').value);
            } else {
                endDate = new Date();
                if (period === 'month') {
                    startDate = new Date(endDate.getFullYear(), endDate.getMonth(), 1);
                } else if (period === 'quarter') {
                    startDate = new Date(endDate.getFullYear(), Math.floor(endDate.getMonth() / 3) * 3, 1);
                } else if (period === 'year') {
                    startDate = new Date(endDate.getFullYear(), 0, 1);
                } else {
                    startDate = new Date(0); // Todo o período
                }
            }

            const filteredCases = cases.filter(c => {
                const caseDate = new Date(c.date);
                return c.userId === currentUser.id && caseDate >= startDate && caseDate <= endDate;
            });

            let yPos = 10;
            doc.text(`Relatório de ${type} para o período: ${formatDate(startDate)} a ${formatDate(endDate)}`, 10, yPos);
            yPos += 10;

            if (type === 'cases') {
                const pending = filteredCases.filter(c => c.status === 'pending').length;
                const inProgress = filteredCases.filter(c => c.status === 'in-progress').length;
                const resolved = filteredCases.filter(c => c.status === 'resolved').length;
                const agreed = filteredCases.filter(c => c.status === 'agreed').length;
                doc.text(`Pendentes: ${pending}`, 10, yPos);
                yPos += 10;
                doc.text(`Em andamento: ${inProgress}`, 10, yPos);
                yPos += 10;
                doc.text(`Resolvidos: ${resolved}`, 10, yPos);
                yPos += 10;
                doc.text(`Acordados: ${agreed}`, 10, yPos);
            } else if (type === 'financial') {
                const totalValue = filteredCases.reduce((sum, c) => sum + (c.value || 0), 0);
                doc.text(`Valor Total: R$ ${totalValue.toFixed(2)}`, 10, yPos);
            } else if (type === 'clients') {
                const clientsMap = new Map();
                filteredCases.forEach(c => {
                    clientsMap.set(c.client, (clientsMap.get(c.client) || 0) + 1);
                });
                clientsMap.forEach((count, client) => {
                    doc.text(`${client}: ${count} casos`, 10, yPos);
                    yPos += 10;
                });
            }

            doc.save('relatorio.pdf');
        }

        // Configurar página de configurações
        function setupSettings() {
            document.getElementById('userNameInput').value = currentUser.name || '';
            document.getElementById('userEmail').value = currentUser.email || '';
            document.getElementById('userPhone').value = currentUser.phone || '';
        }

        // Manipular atualização de perfil
        function handleProfileUpdate(e) {
            e.preventDefault();
            const name = document.getElementById('userNameInput').value;
            const email = document.getElementById('userEmail').value;
            const phone = document.getElementById('userPhone').value;

            currentUser.name = name;
            currentUser.email = email;
            currentUser.phone = phone;

            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = { ...currentUser };
                localStorage.setItem('users', JSON.stringify(users));
            }

            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            document.getElementById('userName').textContent = name;
            document.getElementById('userAvatar').textContent = name.charAt(0).toUpperCase();

            alert('Perfil atualizado com sucesso!');
        }

        // Manipular alteração de senha
        function handlePasswordChange(e) {
            e.preventDefault();
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (currentPassword !== currentUser.password) {
                alert('Senha atual incorreta!');
                return;
            }

            if (newPassword !== confirmPassword) {
                alert('As novas senhas não coincidem!');
                return;
            }

            if (newPassword.length < 6) {
                alert('A nova senha deve ter pelo menos 6 caracteres!');
                return;
            }

            currentUser.password = newPassword;

            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = { ...currentUser };
                localStorage.setItem('users', JSON.stringify(users));
            }

            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            alert('Senha alterada com sucesso!');
            document.getElementById('passwordForm').reset();
        }

        // Abrir modal
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        // Fechar modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Obter texto do status
        function getStatusText(status) {
            const statusMap = {
                'pending': 'Pendente',
                'in-progress': 'Em andamento',
                'resolved': 'Resolvido',
                'agreed': 'Acordado'
            };
            return statusMap[status] || status;
        }

        // Formatar data
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            return new Date(dateString).toLocaleDateString('pt-BR', options);
        }
    </script>
</body>
</html>
